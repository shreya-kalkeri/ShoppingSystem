<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<title>Shopping System</title>

	<link rel="stylesheet" href="imports/fontawesome.css" />

	<link rel="stylesheet" href="imports/bootstrap.min.css">
	<script src="imports/jquery-3.6.0.js"></script>
	<script src="imports/bootstrap.min.js"></script>
	<script src="imports/popper.min.js"></script>

	<link rel="stylesheet" href="imports/jquery.dataTables.min.css">
	<script src="imports/jquery.dataTables.min.js"></script>

	<script src="js/username.js"></script>
	<script src="js/common.js"></script>
	<link rel="stylesheet" href="css/style.css">
</head>

<body>
	<div class="container-fluid">

        <div class="navigation-bar">
    		<nav class="navbar navbar-expand-lg navbar-light bg-light">
    			<a class="navbar-brand" href="index.html">Shopping System</a>

    			<div class="collapse navbar-collapse" id="navbarNavAltMarkup">
    				<div class="navbar-nav">
    					<a class="nav-item nav-link" href="cart.html">Cart</a>
    					<a class="nav-item nav-link" href="orders.html">Orders</a>
    				</div>

					<div class="navbar-nav ms-auto flex-nowrap">
    					<a class="nav-item nav-link login-link" href="login.html">Login</a>
						<a class="nav-item nav-link name-link" href="javascript:void(0)">Name Here</a>
    				</div>
    			</div>
    		</nav>
    	</div>

    	<div class="container mt-5 mb-5">
    		<div class="row">
                <div class="col-9">
                    <div class="table-container">
            			<div class="d-flex justify-content-center">
            				<h3>Products</h3>
            			</div>

                        <div class="search-container">
                            <div class="row">
                                <div class="col-4 mt-5">
                                    <input class="form-control" type="text" id="search-query" placeholder="Search Here...">
                                </div>
                                <div class="col-4 mt-5">
                                    <select class="form-control" id="search-category">
                                        <option value="ALL">Select Category</option>
                                        <option value="Juices">Juices</option>
										<option value="Chocolates">Chocolates</option>
										<option value="Household">Household</option>
										<option value="Creams">Creams</option>
										<option value="Hair Care">Hair Care</option>
										<option value="Paper & Disposables">Paper & Disposables</option>
										<option value="Masalas">Masalas</option>
										<option value="Body Wash">Body Wash</option>
										<option value="Atta & Flours">Atta & Flours</option>
										<option value="Baking">Baking</option>
										<option value="Ready To Cook">Ready To Cook</option>
										<option value="Cleaners">Cleaners</option>
										<option value="Ketchups & Spreads">Ketchups & Spreads</option>
										<option value="Oral Care">Oral Care</option>
										<option value="Pooja Needs">Pooja Needs</option>
										<option value="Repellants & Fresheners">Repellants & Fresheners</option>
										<option value="Biscuits">Biscuits</option>
										<option value="Snacks">Snacks</option>
										<option value="Ghee & Oils">Ghee & Oils</option>
										<option value="Wellness">Wellness</option>
										<option value="Cooking Sauces">Cooking Sauces</option>
										<option value="Soft Drinks">Soft Drinks</option>
										<option value="Utensil Cleaners">Utensil Cleaners</option>
										<option value="Dry Fruits">Dry Fruits</option>
										<option value="Rice & Rice Products">Rice & Rice Products</option>
										<option value="Dairy">Dairy</option>
										<option value="Skin Care">Skin Care</option>
										<option value="Breakfast Cereals">Breakfast Cereals</option>
										<option value="Perfumes">Perfumes</option>
										<option value="Noodles & Pasta">Noodles & Pasta</option>
										<option value="Tea">Tea</option>
										<option value="Diapers & Wipes">Diapers & Wipes</option>
										<option value="Baby Foods">Baby Foods</option>
										<option value="Dals & Pulses">Dals & Pulses</option>
										<option value="Health Drink Mix">Health Drink Mix</option>
										<option value="Shaving Needs">Shaving Needs</option>
										<option value="Kajal & Makeup">Kajal & Makeup</option>
										<option value="Pickles & Chutney">Pickles & Chutney</option>
										<option value="Jams & Honey">Jams & Honey</option>
										<option value="Detergents & Laundry">Detergents & Laundry</option>
										<option value="Sugar, Jaggery & Salt">Sugar, Jaggery & Salt</option>
										<option value="Sanitary Needs">Sanitary Needs</option>
										<option value="Coffee">Coffee</option>
										<option value="Eggs">Eggs</option>
                                    </select>
                                </div>
                                <div class="col-4 mt-5">
                                    <select class="form-control" id="search-rating">
                                        <option value="0">Select Rating</option>
                                        <option value="1">1+</option>
                                        <option value="2">2+</option>
                                        <option value="3">3+</option>
                                        <option value="4">4+</option>
                                    </select>
                                </div>
                                <div class="col-6 mt-5">
                                    <input class="form-control" type="text" id="search-start-range" placeholder="Start Price...">
                                </div>
                                <div class="col-6 mt-5">
                                    <input class="form-control" type="text" id="search-end-range" placeholder="End Price...">
                                </div>
                                <div class="col-6 mt-5">
                                    <button type="button" class="btn btn-primary" id="search-products">Search Products</button>
                                </div>
                                <div class="col-6 mt-5">
                                    <button type="button" class="btn btn-danger" id="reset-products">Reset Search</button>
                                </div>
                            </div>
                        </div>

            			<table class="table table-bordered mt-5" id="product-table">
            				<thead>
            					<tr>
            						<th>Name</th>
            						<th>Price</th>
            						<th>Rating</th>
                                    <th>Add to Cart</th>
            					</tr>
            				</thead>
            				<tbody>
                                <!-- Data will be added Dynamically -->
            				</tbody>
            			</table>
            		</div>
                </div>

                <div class="col-3">
					<div class="d-flex justify-content-center mb-5">
						<h3>Products you may like</h3>
					</div>
					<div class="ml-text-display">
						<p style="color: red">These products are fetched based on your previous purchase history.</p>
						<p><u>Category:</u> <strong id="suggested-category">Fetching...</strong></p>
						<p><u>Price range:</u> <strong id="suggested-price-range">Fetching...</strong>.</p>
					</div>

					<table class="table table-bordered mt-5" id="product-suggestion-table">
						<thead>
							<tr>
								<th>Name</th>
								<th>Price</th>
							</tr>
						</thead>
						<tbody>
							<tr><td colspan="2" style="text-align:center;">Fetching Suggestions...</td></tr>
						</tbody>
					</table>
                </div>
            </div>
    	</div>

    </div>
</body>

<script>
	function addToCart(product_id) {
		var user_data = sessionStorage.getItem("current_user_data");

		var user_id = "";
		if(!(user_data === null)){
			var user_data_json = JSON.parse(user_data);
			user_id = user_data_json["user_id"]
		}

		var jsonData = {
							"user_id": user_id,
							"product_id": product_id
					   }

		$.ajax({
			url: "http://127.0.0.1:5050/add_product_to_cart",
			type: "POST",
			data: JSON.stringify(jsonData),
			contentType:"application/json",
			dataType: 'json',
			success: function(response) {
				alert(response["message"])
			}
		});
	}

	function create_search_product_filter() {
		var query = $("#search-query").val();
        var start_price = $("#search-start-range").val() == "" ? -1 : $("#search-start-range").val();
        var end_price = $("#search-end-range").val() == "" ? -1 : $("#search-end-range").val();
        var rating = $("#search-rating").val();
        var category = $("#search-category").val();

        var jsonData = {
                            "query": query,
                            "start_price": parseFloat(start_price),
                            "end_price": parseFloat(end_price),
                            "rating": parseInt(rating),
                            "category": category
                       }

		fetch_searched_products(jsonData, "product-table");
	}

	$(document).ready(function() {
		create_search_product_filter();
		find_suggested_products();

        $("#search-products").click(create_search_product_filter);

        $("#reset-products").click(function() {
            $("#search-query").val("");
            $("#search-start-range").val("");
            $("#search-end-range").val("");
            $("#search-rating").val("0");
            $("#search-category").val("ALL");

            create_search_product_filter();
        });
	});
</script>

</html>
